#!/bin/bash

# Resolve the absolute path of the repository root in a portable way
SOURCE="${BASH_SOURCE[0]}"
while [ -h "$SOURCE" ]; do
  DIR="$( cd -P "$( dirname "$SOURCE" )" >/dev/null 2>&1 && pwd )"
  SOURCE="$(readlink "$SOURCE")"
  [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE"
done
SCRIPT_DIR="$( cd -P "$( dirname "$SOURCE" )" >/dev/null 2>&1 && pwd )"
REPO_ROOT="$(dirname "$SCRIPT_DIR")"

# Capture the current working directory as the workspace
export WORKSPACE_DIR="$(pwd)"

# Ensure we are in the repo root for relative imports to work if not using PYTHONPATH
cd "$REPO_ROOT"
export PYTHONPATH="$REPO_ROOT"

# Detect virtual environment Python
if [ -f "$REPO_ROOT/.venv/bin/python3" ]; then
    PYTHON_EXEC="$REPO_ROOT/.venv/bin/python3"
elif [ -f "$REPO_ROOT/.venv/bin/python" ]; then
    PYTHON_EXEC="$REPO_ROOT/.venv/bin/python"
elif [ -f "$REPO_ROOT/venv/bin/python3" ]; then
    PYTHON_EXEC="$REPO_ROOT/venv/bin/python3"
else
    PYTHON_EXEC="python3"
fi

# Execute the agents.cli module
exec "$PYTHON_EXEC" -m agents.cli "$@"