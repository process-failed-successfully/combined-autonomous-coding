# App Spec: New First-Class Agent Launcher

## Overview
A modern, robust, and visually appealing CLI launcher for the Autonomous Coding Agent. It replaces the legacy `safe_run.sh` and `bin/start_agent` scripts with a first-class Python-based entry point.

## Core Objectives
- **Simplify Execution**: Make running the agent as easy as a single, intuitive command.
- **Dependency Management**: Automatically verify and prepare the environment (Docker, Git, Python).
- **Premium UX**: Provide a beautiful, interactive CLI experience with clear status reporting.
- **Background Operations**: Support detached execution and management of long-running agents.
- **Robustness**: Replace shell-based permission hacks and container management with reliable logic.

## Key Features

### 1. Interactive CLI Environment
- **Rich Terminal UI**: Use colors, emoji, and formatting to make progress clear and engaging.
- **Progress Indicators**: Show active steps (e.g., "Verifying Docker...", "Fixing Permissions...", "Launching Container...").
- **Smart Logs**: Stream agent logs with filtering and priority levels, avoiding terminal clutter.

### 2. Detached Mode & Agent Management
- **Background Execution**: Launch with `--detached` to run the agent in the background.
- **Named Sessions**: Automatically assign mnemonic names to detached agents (e.g., `flaming-phoenix`) for easy reference.
- **Re-attachment**: `agent attach [name|id]` to jump back into the interactive log stream.
- **Lifecycle Control**:
  - `agent list`: Display all active/detached agents with status and uptime.
  - `agent logs [name|id]`: Tail logs of a background agent without attaching stdin.
  - `agent stop [name|id]`: Gracefully terminate a background agent.

### 3. Dynamic Configuration Management
- **CLI Configuration**: Update settings without manually editing YAML files.
- **Commands**:
  - `agent config set max-iterations 50`: Limit execution cycles.
  - `agent config set model gemini-2.0-flash-exp`: Switch models on the fly.
  - `agent config set agent cursor`: Toggle between Gemini and Cursor agents.
- **Discovery & Guidance**:
  - `agent config list-keys`: Interactive list of all configurable settings with descriptions and default values.
  - `agent config list-models`: List models compatible with the active agent (e.g., show Gemini-specific models vs. Cursor-specific ones).
  - **Context-Aware Hints**: If a user sets an invalid model, suggest the closest valid options.
- **Validation**: Instant feedback on configuration changes (e.g., "Model 'invalid-model' not supported. Did you mean 'gemini-2.0-flash'?").

### 4. Intelligent Pre-flight Checks
- **Environment Audit**: Check for Docker daemon, `docker-compose`, and valid Git configuration.
- **Dependency Auto-Fix**: Automatically handle minor issues (e.g., creating missing directories, fixing local file permissions).
- **Workspace Validation**: Ensure the project directory is safe for agent modification (Git clean check).

### 5. Advanced Jira Integration
- **Context-Aware Fetching**: Simplify transition to Jira mode with a single flag (e.g., `agent run --jira PROJ-123`).
- **Workspace Isolation**: Automatically manage temporary workspaces for Jira tasks and cleanup on completion.
- **Status Sync**: Maintain bi-directional status updates between the local run and Jira tickets.

## Technical Design

### CLI Framework
- **Primary Language**: Python 3.10+
- **Library**: `typer` for CLI structure, `rich` for UI, `docker-py` for orchestration.
- **Command Structure**: 
  - `agent run [path] [--detached] [--name NAME]`: Launch the agent.
  - `agent list`: List active sessions.
  - `agent attach [name]`: Re-attach to a session.
  - `agent logs [name]`: View logs.
  - `agent stop [name]`: Stop a session.
  - `agent config [set|view|reset]`: Manage configuration.

### Visual Assets
- Use `rich` for tables, panels, and live updates.
- Custom ASCII art or stylized banners for the "First Class" feel.

---
*This specification replaces the functionality of legacy scripts:*
- `safe_run.sh`
- `bin/start_agent`
